const h=document.querySelector("#startAudio"),w=document.querySelector(".js_intro"),z=document.querySelector("#introStart"),M=document.querySelector(".js_gameover"),Q=document.querySelector("#gameoverRestart"),o=document.querySelectorAll(".js_heart"),i=document.querySelector(".js_bat"),f=document.querySelectorAll(".js_foodBtn"),O=document.querySelector(".tamagotchi__foods"),X=document.querySelector(".js_dpad-up"),Z=document.querySelector(".js_dpad-down"),$=document.querySelector(".js_dpad-left"),ee=document.querySelector(".js_dpad-right"),te=document.querySelector(".js_btn-a"),ae=document.querySelector(".js_btn-b"),ne=document.querySelector(".js_select-btn"),re=document.querySelector(".js_reset-btn"),oe=["heart--full","heart--half","heart--empty"],c={normal:"bat--normal",sad:"bat--sad",hungry:"bat--hungry",dead:"bat--dead",eating:"bat--eating",love:"bat--love",no:"bat--no",paused:"bat--paused"},G=1e4,se=2100,q=1e3,A="batmagotchi_save";let u=o.length-1,a=0,r=0,b=null,l=!1,p=!1,v=0;const B=new Audio("/sounds/heart-down.mp3"),n=new Audio("/sounds/background.ogg"),H=new Audio("/sounds/game-start.mp3");n.loop=!0;n.volume=.2;function _(){if(y())return;const e={currentHeartIndex:u,currentState:a,emptyHeartsCount:r,savedAt:Date.now()};try{localStorage.setItem(A,JSON.stringify(e))}catch(t){console.warn("No se pudo guardar el progreso:",t)}}function ce(){try{const e=localStorage.getItem(A);if(!e)return null;const t=JSON.parse(e);return typeof t.currentHeartIndex!="number"||typeof t.currentState!="number"||typeof t.emptyHeartsCount!="number"||t.emptyHeartsCount>=o.length?null:t}catch{return null}}function N(){try{localStorage.removeItem(A)}catch(e){console.warn("No se pudo borrar el guardado:",e)}}function ue(e){u=e.currentHeartIndex,a=e.currentState,r=e.emptyHeartsCount,o.forEach((t,T)=>{T>u?d(t,2):T===u?d(t,a):d(t,0)})}function d(e,t){e.classList.remove("heart--full","heart--half","heart--empty"),e.classList.add(oe[t])}function s(e){i.classList.remove("bat--normal","bat--sad","bat--hungry","bat--dead","bat--eating","bat--love","bat--no","bat--paused"),i.classList.add(e)}function F(e){e.classList.add("heart--anim"),setTimeout(()=>e.classList.remove("heart--anim"),300)}function S(){clearInterval(b),b=null}function L(){b||(b=setInterval(k,G))}function E(e){return new Promise(t=>setTimeout(t,e))}function y(){return r>=o.length}function ie(){M.classList.add("gameover--visible")}function x(){l||y()||(l=!0,S(),s(c.paused),C(!0),m())}function C(e){f.forEach(t=>{t.style.pointerEvents=e?"none":"auto",t.style.opacity=e?"0.4":"1"})}function U(){!l||y()||(l=!1,s(g()),L(),C(!1),S(),L())}function j(){S(),m(),N(),M.classList.remove("gameover--visible"),u=o.length-1,a=0,r=0,l=!1,o.forEach(e=>d(e,0)),s(c.normal),i.dataset.busy="false",n.pause(),n.currentTime=0,n.src="/sounds/background.ogg",(!n.paused||h.innerHTML.includes("volume-xmark"))&&n.play(),L()}function P(){p||l||y()||(p=!0,O.classList.add("tamagotchi__foods--visible"),v=0,D())}function m(){p=!1,O.classList.remove("tamagotchi__foods--visible"),f.forEach(e=>e.classList.remove("tamagotchi__food-button--selected"))}function D(){f.forEach((e,t)=>{t===v?e.classList.add("tamagotchi__food-button--selected"):e.classList.remove("tamagotchi__food-button--selected")})}function J(){p&&(v=(v-1+f.length)%f.length,D())}function K(){p&&(v=(v+1)%f.length,D())}function V(){if(!p)return;const e=f[v].dataset.food;Y(e),m()}function k(){if(l||u<0)return;const e=o[u];a===0?(d(e,1),F(e),B.play(),a=1,_()):a===1?(d(e,2),F(e),B.play(),a=2,r++,r>=o.length?(N(),s(c.dead),n.pause(),n.src="/sounds/game-over.mp3",n.play(),setTimeout(()=>{ie()},1500)):(I(),_())):(u--,a=0,k())}function R(){k()}function W(){if(!(r===0&&a===0)){if(a===2)d(o[u],1),a=1,r--;else if(a===1)d(o[u],0),a=0;else{u++,a=2,W();return}I(),_()}}function le(){o.forEach(e=>d(e,0)),u=o.length-1,a=0,r=0,I(),_()}function de(){return r===0&&a===0}function g(){return r>=o.length?c.dead:r===2?c.hungry:r===1?c.sad:c.normal}function fe(){return r===o.length-1&&a===1}function I(){i.dataset.busy!=="true"&&s(g())}async function Y(e){if(!l&&i.dataset.busy!=="true"&&g()!==c.dead){if(de()&&(e==="melon"||e==="moth")){i.dataset.busy="true",S(),s(c.no),await E(q),s(g()),i.dataset.busy="false",L();return}if(i.dataset.busy="true",S(),e==="ajo"&&fe()){R(),i.dataset.busy="false";return}s(c.eating),await E(se),e==="ajo"?(R(),s(c.no),await E(q)):e==="melon"?W():(le(),s(c.love),await E(q)),s(g()),i.dataset.busy="false",L()}}h.innerHTML='<i class="fa-solid fa-volume-xmark"></i>';h.addEventListener("click",()=>{n.paused?(n.play(),h.innerHTML='<i class="fa-solid fa-volume-xmark"></i>'):(n.pause(),h.innerHTML='<i class="fa-solid fa-volume-high"></i>')});z.addEventListener("click",()=>{w.classList.add("intro--closing"),H.volume=.5,H.play(),H.addEventListener("ended",()=>n.play(),{once:!0}),w.addEventListener("animationend",()=>{w.style.display="none";const e=ce();e?(ue(e),s(g())):s(c.normal),b=setInterval(k,G)},{once:!0})});Q.addEventListener("click",()=>{j()});f.forEach(e=>{e.addEventListener("click",()=>{p&&(Y(e.dataset.food),m())})});X.addEventListener("click",()=>{P()});Z.addEventListener("click",()=>{m()});$.addEventListener("click",()=>{J()});ee.addEventListener("click",()=>{K()});te.addEventListener("click",()=>{V()});ae.addEventListener("click",()=>{m()});ne.addEventListener("click",()=>{y()||(l?U():x())});re.addEventListener("click",()=>{confirm("¿Estás seguro de que quieres reiniciar el juego? Se perderá todo el progreso.")&&j()});document.addEventListener("keydown",e=>{switch(e.key){case"ArrowUp":case"w":case"W":e.preventDefault(),P();break;case"ArrowDown":case"s":case"S":e.preventDefault(),m();break;case"ArrowLeft":case"a":case"A":e.preventDefault(),J();break;case"ArrowRight":case"d":case"D":e.preventDefault(),K();break;case"Enter":case" ":e.preventDefault(),V();break;case"Escape":case"Backspace":e.preventDefault(),m();break;case"p":case"P":if(e.preventDefault(),y())return;l?U():x();break;case"r":case"R":e.preventDefault(),confirm("¿Estás seguro de que quieres reiniciar el juego? Se perderá todo el progreso.")&&j();break}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOltdLCJzb3VyY2VzQ29udGVudCI6W10sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiIifQ==
